name: Minecraft + SSHX Terminal

on:
  workflow_dispatch:

jobs:
  start:
    runs-on: ubuntu-latest

    steps:
      - name: Baixar repositório
        uses: actions/checkout@v3

      - name: Instalar Java 17
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: "17"

      - name: Instalar sshx
        run: |
          curl -fsSL https://sshx.io/get | sh
          chmod +x ~/.sshx/bin/sshx
          echo "SSHX instalado."

      - name: Preparar servidor
        run: |
          mkdir -p server
          cp -r server-files/* server/ || true
          echo "eula=true" > server/eula.txt

      - name: Iniciar servidor Minecraft
        run: |
          cd server
          nohup java -Xms1G -Xmx2G -jar server.jar nogui > ../server.log 2>&1 &
          echo "Servidor Minecraft iniciado."

      - name: Iniciar SSHX Terminal
        run: |
          echo "Iniciando sessão SSHX..."
          ~/.sshx/bin/sshx --print-url > sshx_url.txt &
          sleep 3
          echo "===== SSHX URL ====="
          cat sshx_url.txt

      - name: Manter workflow rodando
        run: |
          echo "Servidor + SSHX estão ativos..."
          tail -f /dev/null
